import{q as _,o as V,c as s,d as l,e as t,s as d,w as v,u as n,i as g,R as f,t as i,f as w,C as E,D as F,E as P,x as j,F as B,r as R,g as q,j as C,z as L,l as u,A as K}from"./index-DRo-n_Bo.js";import{T as U}from"./trash-2-MyZNFdKc.js";const $=_("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);const H=_("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);const A=_("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]),O={class:"max-w-4xl mx-auto px-4 py-10"},G={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8"},J={class:"mb-6 p-4 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800/50"},Q={class:"flex flex-wrap items-center gap-3"},W=["disabled"],X={key:0,class:"text-sm text-red-600 dark:text-red-400"},Y={class:"mb-6 flex flex-wrap items-center gap-3"},Z={key:0,class:"py-12 text-center text-gray-500 dark:text-gray-400"},ee={key:1,class:"py-12 text-center text-red-600 dark:text-red-400"},te={key:2,class:"py-12 text-center text-gray-500 dark:text-gray-400"},ae={key:3,class:"border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden bg-white dark:bg-gray-800"},re={class:"w-full text-left text-sm"},se={class:"px-4 py-3"},le={class:"font-medium text-gray-900 dark:text-gray-100"},de={class:"text-gray-400 dark:text-gray-500 ml-2 text-xs"},ne={class:"px-4 py-3"},oe={class:"px-4 py-3 text-gray-500 dark:text-gray-400"},ie={class:"px-4 py-3 flex items-center gap-3 flex-wrap"},ue=["disabled","aria-label","onClick"],xe=["aria-label","onClick"],be={__name:"AdminArticleList",setup(ge){const I=K(),k=u([]),h=u(!0),b=u(null),x=u(""),m=u(!1),p=u(null),c=u(null);function M(r){const e=r?.created_at??r?.CreatedAt;return e?new Date(e).toLocaleDateString("zh-CN"):"—"}function T(r){return r===2?"已发布":"草稿"}async function y(){h.value=!0,b.value=null;try{const r={status:"all",limit:100};x.value.trim()&&(r.tag=x.value.trim());const e=await C.getList(r);k.value=e.data??[]}catch(r){if(r?.response?.status===401){I.replace("/admin");return}b.value="加载列表失败"}finally{h.value=!1}}async function z(r,e){e?.preventDefault?.();const a=r.id??r.ID,o=r.title||"该文章";if(confirm(`确定删除「${o}」？此操作不可恢复。`))try{await C.delete(a),await y()}catch(D){alert(D?.response?.data?.error||D?.message||"删除失败")}}async function N(){p.value=null,m.value=!0;try{await L.publishStatic({full:!0}),alert("全量发布成功")}catch(r){p.value=r?.response?.data?.error||r?.message||"发布失败"}finally{m.value=!1}}async function S(r,e){e?.preventDefault?.();const a=r.id??r.ID;if(!c.value){c.value=a;try{await L.publishStatic({article_id:a}),alert("已发布到静态站")}catch(o){alert(o?.response?.data?.error||o?.message||"发布失败")}finally{c.value=null}}}return V(y),(r,e)=>(s(),l("div",O,[t("header",G,[e[3]||(e[3]=t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"文章管理",-1)),d(n(f),{to:"/admin/articles/new",class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 dark:bg-blue-500 text-white text-sm font-medium rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition"},{default:v(()=>[d(n(H),{class:"w-4 h-4"}),e[2]||(e[2]=g(" 新建文章 ",-1))]),_:1})]),t("div",J,[t("div",Q,[e[4]||(e[4]=t("span",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"发布到静态站",-1)),t("button",{type:"button",disabled:m.value,class:"inline-flex items-center gap-2 px-3 py-2 bg-emerald-600 dark:bg-emerald-500 text-white text-sm font-medium rounded-lg hover:bg-emerald-700 dark:hover:bg-emerald-600 disabled:opacity-50 transition",onClick:N},[d(n(A),{class:"w-4 h-4"}),g(" "+i(m.value?"发布中…":"全量发布"),1)],8,W),p.value?(s(),l("span",X,i(p.value),1)):w("",!0)])]),t("div",Y,[e[5]||(e[5]=t("label",{class:"text-sm font-medium text-gray-700 dark:text-gray-300"},"按标签筛选",-1)),E(t("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>x.value=a),type:"text",class:"w-40 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 placeholder-gray-400 dark:placeholder-gray-500",placeholder:"输入标签",onKeydown:P(y,["enter"])},null,544),[[F,x.value]]),t("button",{type:"button",class:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition",onClick:y}," 筛选 "),x.value?(s(),l("button",{key:0,type:"button",class:"px-3 py-2 text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",onClick:e[1]||(e[1]=a=>{x.value="",y()})}," 清除 ")):w("",!0)]),h.value?(s(),l("div",Z,"加载中...")):b.value?(s(),l("div",ee,i(b.value),1)):k.value.length===0?(s(),l("div",te,[d(n(j),{class:"w-12 h-12 mx-auto mb-2 opacity-50"}),e[7]||(e[7]=t("p",null,"暂无文章",-1)),d(n(f),{to:"/admin/articles/new",class:"text-blue-600 dark:text-blue-400 mt-2 inline-block hover:underline"},{default:v(()=>[...e[6]||(e[6]=[g("新建第一篇文章",-1)])]),_:1})])):(s(),l("div",ae,[t("table",re,[e[10]||(e[10]=t("thead",{class:"bg-gray-50 dark:bg-gray-700/50 border-b border-gray-200 dark:border-gray-700"},[t("tr",null,[t("th",{class:"px-4 py-3 font-semibold text-gray-700 dark:text-gray-300"},"标题"),t("th",{class:"px-4 py-3 font-semibold text-gray-700 dark:text-gray-300 w-28"},"状态"),t("th",{class:"px-4 py-3 font-semibold text-gray-700 dark:text-gray-300 w-28"},"日期"),t("th",{class:"px-4 py-3 font-semibold text-gray-700 dark:text-gray-300 w-56"},"操作")])],-1)),t("tbody",null,[(s(!0),l(B,null,R(k.value,a=>(s(),l("tr",{key:a.id??a.ID,class:"border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50/50 dark:hover:bg-gray-700/30"},[t("td",se,[t("span",le,i(a.title),1),t("span",de,i(a.slug),1)]),t("td",ne,[t("span",{class:q([a.status===2?"text-green-600 bg-green-50 dark:text-green-400 dark:bg-green-900/30":"text-amber-600 bg-amber-50 dark:text-amber-400 dark:bg-amber-900/30","px-2 py-0.5 rounded text-xs font-medium"])},i(T(a.status)),3)]),t("td",oe,i(M(a)),1),t("td",ie,[d(n(f),{to:{name:"AdminArticleEdit",params:{id:String(a.id??a.ID)}},class:"inline-flex items-center gap-1 text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300"},{default:v(()=>[d(n($),{class:"w-4 h-4"}),e[8]||(e[8]=g(" 编辑 ",-1))]),_:1},8,["to"]),a.status===2?(s(),l("button",{key:0,type:"button",disabled:c.value!==null,class:"inline-flex items-center gap-1 text-emerald-600 dark:text-emerald-400 hover:text-emerald-700 dark:hover:text-emerald-300 disabled:opacity-50","aria-label":"发布 "+a.title,onClick:o=>S(a,o)},[d(n(A),{class:"w-4 h-4"}),g(" "+i(c.value===(a.id??a.ID)?"发布中…":"发布"),1)],8,ue)):w("",!0),t("button",{type:"button",class:"inline-flex items-center gap-1 text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300","aria-label":"删除 "+a.title,onClick:o=>z(a,o)},[d(n(U),{class:"w-4 h-4"}),e[9]||(e[9]=g(" 删除 ",-1))],8,xe)])]))),128))])])]))]))}};export{be as default};
